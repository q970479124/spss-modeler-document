# 回归预测方法 #
## 一、 数据探索 ##
### 1. 直方图 ###
> 直方图本质是展示连续数据分布规律的图表，X 轴代表数据的分组区间，Y 轴代表对应区间的数据频次。
<img width="1375" height="907" alt="image" src="https://github.com/user-attachments/assets/fe0779bd-c41c-4ba7-89be-433f914aed52" />

- X轴为数据分组，如房价在十万、二十万、三十万...的连续分组。
- Y轴为X轴分组范围内出现的频率范围。

> **说明：** 直方图主要能看出数据分布状态，比如正态分布、偏态分布
>   偏态分布又分为左偏态(负偏)和右偏态(正偏)
>   - 左偏态： 偏度值 <0，分布的 “长尾” 在左侧，均值 < 中位数 < 众数。
>   - 右偏态： 偏度值 > 0，分布的 “长尾” 在右侧，均值 > 中位数 > 众数。
>   - 对称分布： 偏度值 ≈ 0，均值 ≈ 中位数 ≈ 众数，如正态分布。

#### 处理偏态 ####

**偏态处理流程**
| 步骤     | 操作                                 | 工具/方法                              |
| ------ | ---------------------------------- | ---------------------------------- |
| ① 判断   | 看直方图 + 箱线图 + 计算偏度                  | `sns.histplot`, `scipy.stats.skew` |
| ② 判断影响 | 判断目标/特征、模型类型                       | 表格决策                               |
| ③ 变换   | log / sqrt / Box-Cox / Yeo–Johnson | `np.log1p`, `PowerTransformer`     |
| ④ 验证   | 重新画图 + 比较偏度 + 比较模型RMSE             | `skew()`, `mean_squared_error`     |
| ⑤ 落地   | 在建模/预测中使用变换后的值                     | `exp()` 反变换预测值                     |

---

**偏度计算**
>  - 皮尔逊偏度系数（Pearson Skewness）
>  - 公式为：\(Sk_1 = \frac{3(\bar{x} - Med)}{s}\)
>    - \(\bar{x}\)（样本均值）：所有数据的平均值，对极端值敏感，是偏度计算的 “核心参照”。
>    - Med（样本中位数）：将数据从小到大排序后，位于中间位置的数值，对极端值不敏感，是衡量分布 “中心位置” 的稳定指标。
>    - s（样本标准差）：衡量数据整体离散程度的指标，在这里作为 “标准化因子”，让偏度系数不受数据单位影响（比如身高用厘米或米，偏度结果一致）。
>    - 系数 “3”：是经验系数，通过大量数据验证，用 3 倍的 “均值 - 中位数” 差值除以标准差，能让偏度结果更贴合实际分布的偏斜感知。

|      | 偏度绝对值   | 含义   | 处理建议     |
| ---- | ------- | ---- | -------- |
| 轻微偏态 | < 0.5   | 近似对称 | 可不处理     |
| 中度偏态 | 0.5～1.0 | 偏态明显 | 考虑轻度变换   |
| 严重偏态 | > 1.0   | 强偏态  | 建议变换或标准化 |

---

**判断是否需要处理偏态**
| 情况                       | 是否需要处理              |       |        |
| ------------------------ | ------------------- | ----- | ------ |
| 目标变量用于线性回归、线性建模          | ✅ 需要（保持残差正态）        |       |        |
| 特征变量用于线性或距离模型            | ✅ 需要（保持尺度合理）        |       |        |
| 树模型（RF/XGBoost/LightGBM） | ❌ 可不处理              |       |        |
| 偏态不大（                    | skew                | <0.5） | ❌ 可不处理 |
| 数据带 0 或负值                | ⚠️ 不可直接取 log，需要特殊变换 |       |        |

---

**偏态处理方法**
| 方法                 | 适用条件      | Python 实现                                                      | 说明          |
| ------------------ | --------- | -------------------------------------------------------------- | ----------- |
| **log-transform**  | 数据>0 且右偏  | `np.log(y)` 或 `np.log1p(y)`                                    | 压缩右尾        |
| **平方根变换 (sqrt)**   | 数据≥0，轻度右偏 | `np.sqrt(y)`                                                   | 较温和         |
| **Box–Cox 变换**     | 数据>0      | `scipy.stats.boxcox(y)`                                        | 自动找最佳λ      |
| **Yeo–Johnson 变换** | 数据可含负值    | `sklearn.preprocessing.PowerTransformer(method='yeo-johnson')` | 广义适用        |
| **反转 + log**       | 左偏（负偏）    | `np.log(y.max()+1 - y)`                                        | 把左偏变右偏再 log |

---
**常用处理**
| 方法                        | 适用场景    | 说明         |
| ------------------------- | ------- | ---------- |
| 对数/Box–Cox/Yeo–Johnson 变换 | 特征为正且右偏 | 平滑分布、线性化   |
| 分箱（binning）或离散化           | 极度偏态或长尾 | 用分位数切分更稳健  |
| Winsorization（截尾）         | 有极端离群值  | 限制极端值对模型影响 |
| 标准化或归一化                   | 轻微偏态    | 缩放到统一范围    |

---

**进阶：偏态后的建模策略**
| 模型类型          | 偏态处理重点              | 备注          |
| ------------- | ------------------- | ----------- |
| 线性回归          | ✅ 对目标变量做 log        | 确保残差正态      |
| Lasso / Ridge | ✅ 对所有偏态特征做 log/sqrt | 提升收敛与解释性    |
| 树模型           | ⚙️ 可选               | 有时可只平滑极端值   |
| 时间序列 / 回归预测   | ✅ 对目标 log，预测后反变换    | 常用于预测销量、价格等 |
| 聚类 / PCA      | ✅ 对特征变换             | 减少方差主导效应    |

---



  
  
